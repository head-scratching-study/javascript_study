# Chapter23 Questions

### 1. 실행 컨텍스트에 대해 설명해주세요.

- 실행 컨텍스트는 식별자를 등록하고 관리하는 스코프와 코드의 실행 순서 관리를 구현한 내부 메커니즘입니다. 좀 더 구체적으로 말하면, 실행 컨텍스트의 렉시컬 환경에서 식별자와 스코프를 관리하고, 실행 컨텍스트 스택에서 코드의 실행 순서를 관리합니다.

<br>

### 2. 전역 렉시컬 환경에 대해 설명해주세요.

- 전역 렉시컬 환경은 객체 환경 레코드와 선언적 환경 레코드로 구성되어 있습니다.
- 객체 환경 레코드는 var 키워드로 선언한 전역 변수와 함수 선언문으로 선언한 전역 함수, 빌트인 전역 프로퍼티, 빌트인 전역 함수, 표준 빌트인 객체를 관리합니다.
- 선언적 환경 레코드는 let, const 키워드로 선언한 전역 변수를 관리합니다.

<br>

### 3. 식별자 결정에 대해 설명해주세요.

- 동일한 이름의 식별자가 다른 스코프에 여러 개 존재할 수 있으므로, 어느 스코프의 식별자를 참조하면 되는지 결정하는 것을 식별자 결정이라고 합니다.
- 식별자 결정을 위해 식별자를 검색할 때는 실행 중인 실행 컨텍스트의 렉시컬 환경에서 검색합니다. 만약 실행 중인 실행 컨텍스트의 렉시컬 환경에서 식별자를 검색할 수 없다면 외부 렉시컬 환경에 대한 참조가 가리키는 렉시컬 환경, 즉 상위 스코프로 이동하여 식별자를 검색합니다.

<br>

#### 4. 다음의 예제 코드를 실행 컨텍스트와 연관지어 설명해주세요.

```js
var x = 1;
const y = 2;

function foo(a) {
  var x = 3;
  const y = 4;

  function bar(b) {
    const z = 5;
    console.log(a + b + x + y + z);
  }

  bar(10);
}

foo(20); // 42
```

- 먼저 전역 객체가 생성됩니다.
- 전역 코드가 평가됩니다.
  - 전역 실행 컨텍스트가 생성되고 전역 렉시컬 환경 레코드가 완성된 후 실행 컨텍스트 스택에 전역 실행 컨텍스트가 푸시됩니다.
    - 전역 컨텍스트의 렉시컬 환경의 객체 환경 레코드에 BindingObject를 통해 전역 변수 x와 전역 함수 foo가 전역 객체의 프로퍼티와 메서드가 됩니다.
    - 전역 렉시컬 환경의 선언적 환경 레코드에 전역 변수 y가 등록됩니다.
    - 전역 렉시컬 환경 레코드의 \[\[GlobalThisValue]]에 전역 객체가 바인딩됩니다.
    - 전역 렉시컬 환경의 외부 렉시컬 환경에 대한 참조는 전역 코드를 포함한 소스 코드가 없으므로 null이 됩니다.
- 전역 코드가 실행됩니다.
  - 전역 변수 x, y에 값이 할당되고, foo 함수가 호출됩니다.
- foo 함수가 호출되면 전역 코드의 실행을 일시 중단하고 foo 함수 내부로 코드의 제어권이 넘어갑니다. 그리고 foo 함수 코드가 평가됩니다.
  - foo 함수 실행 컨텍스트가 생성되고 함수 렉시컬 환경이 완성된 이후 실행 컨텍스트 스택으로 푸시됩니다.
  - 함수 환경 레코드에 매개변수 a, arguments 객체, 함수 내부에서 선언한 지역 변수 x, y와 중첩 함수 bar가 등록됩니다.
  - foo 함수는 일반 함수로 호출되었으므로 함수 환경 레코드의 \[\[ThisValue]] 내부 슬롯에 전역 객체가 바인딩됩니다.
  - foo 함수 정의는 전역 코드 평가 시점에 평가되므로, foo 함수 렉시컬 환경의 외부 렉시컬 환경에 대한 참조에 전역 렉시컬 환경의 참조가 할당됩니다.
- foo 함수의 소스코드가 순차적으로 실행됩니다. 매개변수 a에 인수가 할당되고, 지역 변수 x, y에 값이 할당됩니다. 그리고 bar 함수가 호출됩니다.
- bar 함수가 호출되면 bar 함수 내부로 코드의 제어권이 이동합니다. 그리고 bar 함수 코드가 평가됩니다.
  - bar 함수 실행 컨텍스트가 생성되고 함수 렉시컬 환경이 완성된 이후 실행 컨텍스트 스택으로 푸시됩니다.
  - 함수 환경 레코드에 매개변수 b, arguments 객체, 함수 내부에서 선언한 지역 변수 z가 등록됩니다.
  - bar 함수는 일반 함수로 호출되었으므로 함수 환경 레코드의 \[\[ThisValue]]에 전역 객체가 바인딩됩니다.
  - bar 함수 정의는 foo 함수 평가 시점에 평가되므로, bar 함수 렉시컬 환경의 외부 렉시컬 환경에 대한 참조는 foo 함수 렉시컬 환경의 참조가 할당됩니다.
- bar 함수의 코드가 순차적으로 실행됩니다. 매개변수 b에 인수가 할당되고,지역 변수 z에 값이 할당됩니다. 그리고 console.log(a + b + x + y + z)가 실행됩니다.
  - console 식별자를 스코프 체인에서 검색합니다.
  - console 식별자에 바인딩된 객체인 console 객체에서 log 메서드를 검색합니다.
  - 표현식 a + b + x + y + z을 평가합니다.
  - 표현식 a + b + x + y + z가 평가되어 생성된 값을 console.log 메서드에 전달하여 호출합니다.
- console.log 메서드가 호출되고 종료되면 더 이상 실행할 코드가 없으므로 bar 함수 코드의 실행이 종료됩니다. 이때 실행 컨텍스트 스택에서 bar 함수 실행 컨텍스트가 팝되어 제거되고 foo 함수 실행 컨텍스트가 실행 중인 실행 컨텍스트가 됩니다.
- bar 함수가 종료되면 더 이상 실행할 코드가 없으므로 foo 함수 코드의 실행이 종료됩니다. 이때 실행 컨텍스트 스택에서 foo 함수 실행 컨텍스트가 팝되어 제거되고 전역 실행 컨텍스트가 실행 중인 실행 컨텍스트가 됩니다.
- foo 함수가 종료되면 더 이상 실행할 전역 코드가 없으므로 전역 코드의 실행이 종료됩니다. 이때 실행 컨택스트 스택에서 전역 실행 컨텍스트가 팝되어 실행 컨텍스트 스택에는 아무것도 남아있지 않게 됩니다.
